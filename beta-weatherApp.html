<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Document</title>
</head>
<body>

     <img src = "http://wonderfulengineering.com/wp-content/uploads/2014/07/Landscape-wallpapers-31.jpg" id ="img1">
     <img src = "https://i.redd.it/mrlxr6luuc411.jpg" id = "img2">
     <nav id="navbar">
          <h1 id="title">Weather App</h1>
          <button class = "forest" id="toggleMode" title = "Toggle images"><i class="fa-solid fa-tree"></i></button>
          <h3 style = "position: relative; float: right; right: 5%; top: -3px;">Click to toggle background images -></h3>
     </nav>
     <div class="container">
          <div class="text-container">
               <div class="header">
                    <h2 id="day">loading...</h2>
                    <h2 id="date">loading...</h2>
               </div>
               <div class="body">
                    <h2 id="city">loading...</h2>
                    <hr>
                    <h2 id="tempText">Temp</h2> <h2 id="temp">loading...</h2>
                    <br>
                    <h2 id="humidityText">Humidity</h2> <h2 id="humidity">loading...</h2>
                    <br>
                    <h2 id="sunriseText">Sunrise</h2> <h2 id="sunrise">loading...</h2>
                    <br>
                    <h2 id="sunsetText">Sunset</h2> <h2 id="sunset">loading...</h2>
                    <hr>
                    <div id="errorText">
                         <h2 id="error">Fetching...</h2>
                    </div>
               </div>
          </div>
     </div>

     <script>
          let toggleModeBtn = document.getElementById("toggleMode");
          let nav = document.getElementById("navbar");
          let day = document.getElementById("day");
          let img1 = document.getElementById("img1");
          let dateText = document.getElementById("date");
          let cityText = document.getElementById("city");
          let temp = document.getElementById("temp");
          let humidity = document.getElementById("humidity");
          let sunrise = document.getElementById("sunrise");
          let sunset = document.getElementById("sunset");
          let errorText = document.getElementById("errorText");
          let error = document.getElementById("error");

          toggleModeBtn.addEventListener("click", () => {
               if (toggleModeBtn.innerHTML == '<i class="fa-solid fa-tree"></i>') {
                    toggleModeBtn.className = "water";
                    toggleModeBtn.innerHTML = '<i class="fa-solid fa-mountain"></i>';
                    img1.style.transition = "1s ease";
                    nav.style.transition = "1s ease";
                    img1.style.transform = "translateX(-100%)";
                    img2.style.transition = "1s ease";
                    img2.style.transform = "translateX(0%)";
               } else {
                    toggleModeBtn.className = "forest";
                    toggleModeBtn.innerHTML = '<i class="fa-solid fa-tree"></i>';
                    img1.style.transform = "translateX(0%)";
                    nav.style.transition = "1s ease";
                    img2.style.transition = "1s ease";
                    img1.style.transition = "1s ease";
                    img2.style.transform = "translateX(100%)";
               }
          });

          let time = new Date();
          let dayHTML = time.getDay();
          
          let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
          let month = months[time.getMonth()];
          let date = time.getDate();

          let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
          
          day.innerText = days[dayHTML];
          dateText.innerText = `${month} ${date}`;

          const displayWeather = async () => {
               const IPinfo = await fetch("https://ipinfo.io/json?token=5b6fbb1bfd87de");
               let IPdata = await IPinfo.json();
               let city = IPdata.city;
               let state = IPdata.region;
               let country = IPdata.country;

               let unit;

               if (country == "US") {
                    unit = "imperial";
               } else {
                    unit == "metric";
               }

               cityText.innerText = `${city}, ${state}`;

               const weatherInfoConnection = await fetch(`https://api.openweathermap.org/data/2.5/weather?units=${unit}&q=${city}&appid=d91537ca6b9f09f94af35eb11f1e90f0`);
               const weather = await weatherInfoConnection.json();

               let temperature = (weather.main.temp).toFixed(1);
               let humid = (weather.main.humidity);
               let sunriseTime = weather.sys.sunrise;
               let sunsetTime = weather.sys.sunset;

               // sunrise and sunset formatting
               var sunriseDate = new Date(sunriseTime*1000);
               var sunriseHour = sunriseDate.getHours();
               var sunriseMinute = sunriseDate.getMinutes();

               let sunriseAMPM = "AM";

               if (sunriseHour > 12) {
                    sunriseAMPM = "PM";
                    sunriseHour = sunriseHour - 12;
               }
               if (sunriseMinute < 10) {
                    sunriseMinute = "0" + sunriseMinute;
               }

               var formattedSunriseTime = sunriseHour + ":" + sunriseMinute;

               var sunsetDate = new Date(sunsetTime*1000);
               var sunsetHour = sunsetDate.getHours();
               var sunsetMinute = sunsetDate.getMinutes();

               let sunsetAMPM = "AM";

               if (sunsetHour > 12) {
                    sunsetHour = sunsetHour - 12;
                    sunsetAMPM = "PM";
               }
               if (sunsetMinute < 10) {
                    sunsetMinute = "0" + sunsetMinute;
               }

               var formattedSunsetTime = sunsetHour + ":" + sunsetMinute;
               // end of sunrise and sunset formatting

               temp.innerText = `${temperature} (${(unit == "imperial" ? "F" : "C")})`;
               humidity.innerText = `${humid}%`;
               sunrise.innerText = `${formattedSunriseTime} ${sunriseAMPM}`;
               sunset.innerText = `${formattedSunsetTime} ${sunsetAMPM}`;

               //errors
               function changableError() {
                    if (cityText.innerText != "") {
                         errorText.style.display = "none";
                    }
               }

               setTimeout(changableError, 1000);
          };

          setTimeout(displayWeather, 1000);
          setTimeout(displayWeather, 1000);
          setTimeout(displayWeather, 1000);
          setTimeout(displayWeather, 1000);
          setTimeout(displayWeather, 1000);
     </script>
     <script src="https://kit.fontawesome.com/4931b3c0b5.js" crossorigin="anonymous"></script>

     <style>
          @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@200;400;700&display=swap');

          * {
               font-family: Chivo Mono;
               font-weight: 400;
          }
          body {
               overflow: hidden;
               background: rgb(0, 0, 0);
               color: white;
          }
          .forest {
               background: rgb(255, 125, 168);
               color: white;
               transition: 1s ease;
               transform: rotate(360deg);
          }
          .water {
               background: rgb(123, 180, 255);
               color: white;
               transition: 1s ease;
               transform: rotate('360deg');
               
          }
          #title {
               margin-left: 3%;
               margin-top: 15px;
          }
          .water, .forest {
               width: 40px;
               height: 40px;
               border-radius: 7px;
               font-size: 17px;
               text-align: center;
               border: none;
               position: relative;
               float: right;
               top: 8px;
               right: 4%;
          }
          .water, .forest, #title {
               display: inline-block;
          }
          nav {
               margin: -8px;
               height: 57.5px;
               border-bottom: 2px solid rgb(255, 255, 255);
               color: rgb(255, 255, 255);
               background-color: rgba(41, 41, 41, 0.3);
               border-radius: 5px;
               box-shadow: 0px 0px 10px rgb(255, 255, 255);
          }
          #img1, #img2 {
               position: absolute;
               z-index: -10;
               width: 100%;
               height: 100%;
               margin-left: -8px;
               opacity: 0.5;
          }
          #img2 {
               transform: translateX(100%);
               opacity: 0.3;
          }
          .container {
               border: 1px solid white;
               backdrop-filter: blur(7px);
               border-radius: 30px;
               height: 500px;
               width: 400px;
               position: absolute;
               left: 50%;
               top: 50%;
               transform: translate(-50%, -50%);
          }
          .text-container {
               margin-left: 20px;
               width: 360px;
               height: 100px;
          }
          #date {
               position: relative;
               float: right;
          }
          #day, #date, #humidityText, #humidity {
               display: inline-block;
          }
          #city {
               color: white;
               margin-top: -10px;
               margin-top: 0px;
               font-weight: 200;
               font-size: 25px;
               width: 360px;
               text-align: center;
          }
          #tempText, #temp, #humidityText, #humidity, #sunsetText, #sunset, #sunriseText, #sunrise {
               line-height: 20px;
          }
          #tempText, #temp, #sunriseText, #sunrise, #sunsetText, #sunset {
               display: inline-block;
          }
          #tempText, #humidityText, #sunriseText, #sunsetText {
               font-weight: 200;
          }
          #temp, #humidity, #sunrise, #sunset {
               font-weight: 400;
               position: relative;
               float: right;
          }
          #errorText {
               position: absolute;
               background-color: rgba(33, 255, 162, 0.534);
               border: 2px solid rgb(107, 255, 174);
               width: 89%;
               margin-top: 17.5px;
               border-radius: 20px;
               text-align: center;
               display: block;
          }
     </style>
</body>
</html>